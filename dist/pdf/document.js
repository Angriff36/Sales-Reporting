"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PAGE = void 0;
exports.createDocument = createDocument;
exports.collectBuffer = collectBuffer;
exports.drawHeader = drawHeader;
exports.drawPageFooter = drawPageFooter;
exports.addPageBreak = addPageBreak;
const pdfkit_1 = __importDefault(require("pdfkit"));
const types_1 = require("../types");
exports.PAGE = {
    width: 612,
    height: 792,
    margin: 50,
    contentWidth: 512,
    contentBottom: 742,
};
function createDocument() {
    return new pdfkit_1.default({
        size: 'letter',
        margin: exports.PAGE.margin,
        bufferPages: true,
        info: {
            Title: 'Sales Report',
            Author: '@capsule-pro/sales-reporting',
            Creator: '@capsule-pro/sales-reporting',
        },
    });
}
function collectBuffer(doc) {
    return new Promise((resolve, reject) => {
        const chunks = [];
        doc.on('data', (chunk) => chunks.push(chunk));
        doc.on('end', () => resolve(Buffer.concat(chunks)));
        doc.on('error', reject);
        doc.end();
    });
}
function drawHeader(doc, companyName, reportTitle, dateRangeText) {
    const headerHeight = 70;
    doc.rect(0, 0, exports.PAGE.width, headerHeight).fill(types_1.COLORS.navy);
    doc.fontSize(18).font('Helvetica-Bold').fillColor(types_1.COLORS.white)
        .text(companyName || 'Sales Report', exports.PAGE.margin, 18, {
        width: exports.PAGE.contentWidth,
        lineBreak: false,
    });
    doc.fontSize(10).font('Helvetica').fillColor('#B0C4DE')
        .text(`${reportTitle}  |  ${dateRangeText}`, exports.PAGE.margin, 42, {
        width: exports.PAGE.contentWidth,
        lineBreak: false,
    });
    const returnY = headerHeight + 20;
    doc.x = exports.PAGE.margin;
    doc.y = returnY;
    return returnY;
}
function drawPageFooter(doc) {
    const range = doc.bufferedPageRange();
    const pageCount = range.count;
    for (let i = 0; i < pageCount; i++) {
        doc.switchToPage(i);
        const savedBottom = doc.page.margins.bottom;
        doc.page.margins.bottom = 0;
        doc.moveTo(exports.PAGE.margin, exports.PAGE.height - 40)
            .lineTo(exports.PAGE.width - exports.PAGE.margin, exports.PAGE.height - 40)
            .strokeColor(types_1.COLORS.border)
            .lineWidth(0.5)
            .stroke();
        doc.fontSize(7).font('Helvetica').fillColor(types_1.COLORS.lightText)
            .text(`Generated by @capsule-pro/sales-reporting`, exports.PAGE.margin, exports.PAGE.height - 32, { width: exports.PAGE.contentWidth / 2, lineBreak: false });
        doc.fontSize(7).font('Helvetica').fillColor(types_1.COLORS.lightText)
            .text(`Page ${i + 1} of ${pageCount}`, exports.PAGE.width / 2, exports.PAGE.height - 32, { width: exports.PAGE.contentWidth / 2, align: 'right', lineBreak: false });
        doc.page.margins.bottom = savedBottom;
        doc.y = exports.PAGE.margin;
    }
}
function addPageBreak(doc) {
    doc.addPage();
    return exports.PAGE.margin;
}
//# sourceMappingURL=document.js.map